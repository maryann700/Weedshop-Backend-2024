<?phpinclude(__DIR__ . "/../system/config.inc.php");if(empty($_SERVER['HTTP_APPKEY'])) {    $result = array("response"=>"false","msg"=>"Please provide api key.","data"=>array());} else if($_SERVER['HTTP_APPKEY'] != APPKEY) {    $result = array("response"=>"false","msg"=>"Please provide valid api key.","data"=>array());} else if(!isset($_POST["driver_id"]) || empty($_POST["driver_id"])) {    $result = array("response"=>"false","msg"=>"Please provide driver id.","data"=>array());} else {    $driver_id = $_POST["driver_id"];        $db->where("driver_id",$driver_id);    $db->where("status","Inprocess");    $db->orderBy("order_date","asc");    $inprocess = $db->getOne("orders");        if($db->count <= 0) {        $db->join("driver d","dr.driver_id=d.id","LEFT");        $db->where ("d.adminApproved", "Approved");        $db->where ("dr.driver_id", $driver_id);        $db->where ("dr.status", 'Pending');        $reuest = $db->get ("driver_request dr",array(0,1),"dr.driver_id,dr.order_id");           if ($db->count > 0) {     //        $dist = ',111.111 * DEGREES(ACOS(COS(RADIANS(dl.latitude))    //        * COS(RADIANS(s.latitude))    //        * COS(RADIANS(dl.longitude - s.longitude))    //        + SIN(RADIANS(dl.latitude))    //        * SIN(RADIANS(s.latitude)))) AS store_distance';           $dist1 = ',111.111 * DEGREES(ACOS(COS(RADIANS(o.delivery_latitude))            * COS(RADIANS(dl.latitude))            * COS(RADIANS(o.delivery_longitude - dl.longitude))            + SIN(RADIANS(o.delivery_latitude))            * SIN(RADIANS(dl.latitude)))) AS delivery_distance';           $db->join("driver d","$driver_id=d.id","LEFT");           $db->join("driver_location dl","d.id=dl.driver_id","LEFT");                   $db->where("o.id", $reuest[0]['order_id']);            $db->where("o.status", 'Pending');           $orders = $db->get ("orders o",array(0,1),"o.id,o.order_code,o.user_id,o.driver_id,o.store_id,o.order_date,o.final_total,o.status,o.delivery_address,o.delivery_latitude,o.delivery_longitude,dl.address as driver_address,dl.latitude as driver_latitude, dl.longitude as driver_longitude$dist1");           if($db->count > 0) {                $time =  ($orders[0]['delivery_distance']/50);                           $time = gmdate("H:i", $time);                           $orders[0]['delivery_time'] = $time;                $orders[0]['request_timeout'] = REQUESTTIMEOUT;                            $result = array("response"=>"true","msg"=>"Order request","data"=>$orders);           } else {                $result = array("response"=>"true","msg"=>"Not found any order!","data"=>array());           }           } else {            $result = array("response"=>"false","msg"=>"Request not found.","data"=>array());        }    } else {        $dist1 = ',111.111 * DEGREES(ACOS(COS(RADIANS(o.delivery_latitude))        * COS(RADIANS(dl.latitude))        * COS(RADIANS(o.delivery_longitude - dl.longitude))        + SIN(RADIANS(o.delivery_latitude))        * SIN(RADIANS(dl.latitude)))) AS delivery_distance';       $db->join("driver d","$driver_id=d.id","LEFT");       $db->join("driver_location dl","d.id=dl.driver_id","LEFT");               $db->where("o.id", $inprocess['id']);               $orders = $db->get ("orders o",array(0,1),"o.id,o.order_code,o.user_id,o.driver_id,o.store_id,o.order_date,o.final_total,o.status,o.delivery_address,o.delivery_latitude,o.delivery_longitude,dl.address as driver_address,dl.latitude as driver_latitude, dl.longitude as driver_longitude$dist1");       if($db->count > 0) {            $time =  ($orders[0]['delivery_distance']/50);                       $time = gmdate("H:i", $time);                       $orders[0]['delivery_time'] = $time;            $orders[0]['request_timeout'] = REQUESTTIMEOUT;                        $result = array("response"=>"true","msg"=>"Order request","data"=>$orders);       } else {           $result = array("response"=>"false","msg"=>"Order not found.","data"=>$orders);       }    }}echo sendResponse($result);exit;