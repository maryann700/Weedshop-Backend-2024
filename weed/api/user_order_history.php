<?phpinclude(__DIR__ . "/../system/config.inc.php");if(empty($_SERVER['HTTP_APPKEY'])) {    $result = array("response"=>"false","msg"=>"Please provide api key.","data"=>array());} else if($_SERVER['HTTP_APPKEY'] != APPKEY) {    $result = array("response"=>"false","msg"=>"Please provide valid api key.","data"=>array());} else if(!isset($_POST["user_id"]) || empty($_POST["user_id"])) {    $result = array("response"=>"false","msg"=>"Please provide user id.","data"=>array());} else if(!isset($_POST["page"]) || empty($_POST["page"])) {    $result = array("response"=>"false","msg"=>"Please provide page.","data"=>array());} else {    $user_id = trim($_POST["user_id"]);     $page = $_POST["page"];    $filter_text = trim($_POST["filter_text"]);    $filter_date = trim($_POST["filter_date"]);        if(isset($filter_date) && $filter_date!="") {                switch ($_POST["filter_date"]) {            case "1":                $date = date("Y-m-d H:i:s",strtotime("-1 months"));                $db->where("o.order_date",$date,">=");                break;            case "2":                $date = date("Y-m-d H:i:s",strtotime("-6 months"));                $db->where("o.order_date",$date,">=");                break;            case "3":                $date = date("Y-m-d H:i:s",strtotime("-1 year"));                $db->where("o.order_date",$date,">=");                break;        }    }    $db->join("order_products op","o.id=op.order_id","LEFT");    if(isset($filter_text) && $filter_text!="") {        $db->where("LOWER(op.product_name)","%".strtolower($filter_text)."%","LIKE");             }    $db->where("o.user_id", $user_id);        $db->where("o.status","Completed");      $db->groupBy("op.order_id");    $db->orderBy("o.order_date","desc");    $db->pageLimit = 5;    $orders = $db->arraybuilder()->paginate ("orders o",$page,"o.id,o.order_code,o.user_id,o.driver_id,o.store_id,o.order_date,o.final_total,o.status");    //echo $db->getLastQuery(); exit;    $totalPages = $db->totalPages;            if ($db->count > 0) {             for($i=0;$i<count($orders);$i++) {            $db->join("products p","op.product_id=p.id","LEFT");            $db->join("type t","p.type_id=t.id","LEFT");            $db->where("op.order_id",$orders[$i]['id']);            $db->orderBy("op.id","asc");            $prod_detail = $db->get("order_products op",null,'op.order_id,op.product_id,op.product_name,op.price,op.quantity,op.attribute_description,p.image,CONCAT("'.PRODUCT_IMG_URL.'",p.`image`) AS `image_url`,t.name as type,t.color');            $orders[$i]['total_products'] = count($prod_detail);            $orders[$i]['products'] = $prod_detail;        }        $msg = "Order info!";        $result = array("response"=>"true","msg"=>$msg,"data"=> $orders,"totalPages"=>$totalPages);                   } else {        $result = array("response"=>"false","msg"=>"Not any order found!","data"=>array());    }}echo sendResponse($result);exit;