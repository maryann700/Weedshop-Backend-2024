<?phpinclude(__DIR__ . "/../system/config.inc.php");if(empty($_SERVER['HTTP_APPKEY'])) {    $result = array("response"=>"false","msg"=>"Please provide api key.","data"=>array());} else if($_SERVER['HTTP_APPKEY'] != APPKEY) {    $result = array("response"=>"false","msg"=>"Please provide valid api key.","data"=>array());} else if(!isset($_POST["store_id"]) || empty($_POST["store_id"])) {    $result = array("response"=>"false","msg"=>"Please provide store id.","data"=>array());} else if(!isset($_POST["page"]) || empty($_POST["page"])) {    $result = array("response"=>"false","msg"=>"Please provide page number.","data"=>array());} else {    if(isset($_POST["category_id"]) && $_POST["category_id"]!='') {        $db->where("p.category_id",$_POST["category_id"]);    }    if(isset($_POST["type_id"]) && $_POST["type_id"]!='') {        //$db->where("p.type_id",$_POST["type_id"]);        $type_array = explode(",",$_POST["type_id"]);        $db->where('p.type_id', $type_array, 'IN');    }    $page = $_POST["page"];    $db->join("category c", "p.category_id=c.id", "LEFT");    $db->join("type t", "p.type_id=t.id", "LEFT");    $db->where("p.store_id",trim($_POST["store_id"]));    $db->where("p.status",'Active');        $db->orderBy ("p.created_date","desc");    $db->pageLimit = 10;    $products = $db->arraybuilder()->paginate('products p',$page,'p.*,c.name as category,t.name as type,CONCAT("'.PRODUCT_IMG_URL.'",p.`image`) AS `image_url`');    //$products = $db->get ('products');        // echo $db->getLastQuery(); exit;    $totalPages = $db->totalPages;    if($db->count > 0) {        //get attributes        for($i=0;$i<count($products);$i++) {            $db->join("attributes a", "pa.attribute_id=a.id", "LEFT");            $db->where("pa.product_id",$products[$i]['id']);            $attributes = $db->get ('product_attributes pa',null,'a.name,pa.attribute_text,pa.attribute_id');            $products[$i]['attributes'] = $attributes;        }        $result = array("response"=>"true","msg"=>"Products found!","data"=>$products,"totalPages"=>$totalPages);     } else {        $result = array("response"=>"false","msg"=>"Not any product found!","data"=>array());     }}echo sendResponse($result);exit;